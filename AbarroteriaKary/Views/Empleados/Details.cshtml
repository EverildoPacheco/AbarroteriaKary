@model AbarroteriaKary.ModelsPartial.EmpleadoViewModel
@{
    ViewData["Title"] = "Detalle de Empleado";
    Layout = "~/Views/Shared/_Layout.cshtml";

    bool esActivo = Model.EstadoActivo;
    var aud = ViewBag.Auditoria; // { CreadoPor, FechaCreacion, ModificadoPor, FechaModificacion, EliminadoPor, FechaEliminacion }
}

<div class="ak-page">

    <!-- Franja 1: Título -->
    <div class="ak-header container-fluid px-3 px-md-4">
        <h1 class="ak-form-title m-1 mb-4">Detalle de empleado</h1>
    </div>

    <!-- Franja 2: Contenido -->
    <div class="ak-main">
        <div class="container-fluid px-3 px-md-4">

            <!-- Card translúcida (mismo look que Crear/Editar) -->
            <div class="card ak-card translucent shadow-sm w-100">
                <div class="card-body">

                    <!-- 4 items en una sola línea -->
                    <div class="row g-4 ak-dl-row">
                        <!-- Código -->
                        <div class="col-12 col-lg-3">
                            <div class="ak-dl">
                                <div class="ak-dl__label">Código</div>
                                <div class="ak-dl__value text-monospace">@Model.Id</div>
                            </div>
                        </div>

                        <!-- Nombre completo -->
                        <div class="col-12 col-lg-3">
                            <div class="ak-dl">
                                <div class="ak-dl__label">Nombre completo</div>
                                <div class="ak-dl__value">@Model.NombreCompleto</div>
                            </div>
                        </div>

                        <!-- Puesto -->
                        <div class="col-12 col-lg-3">
                            <div class="ak-dl">
                                <div class="ak-dl__label">Puesto</div>
                                <div class="ak-dl__value">@(!string.IsNullOrWhiteSpace(Model.PuestoNombre) ? Model.PuestoNombre : Model.PuestoId)</div>
                                <div class="form-text">ID de puesto: @(Model.PuestoId ?? "—")</div>
                            </div>
                        </div>

                        <!-- Estado -->
                        <div class="col-12 col-lg-3">
                            <div class="ak-dl">
                                <div class="ak-dl__label">Estado</div>
                                <div class="ak-dl__value">
                                    <span class="badge @(esActivo ? "bg-success" : "bg-danger") text-white px-3 py-2">
                                        @(esActivo ? "ACTIVO" : "INACTIVO")
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Línea extra: Identificación / contacto / fechas -->
                    <div class="row g-4 mt-1 ak-dl-row">
                        <!-- CUI -->
                        <div class="col-12 col-lg-3">
                            <div class="ak-dl">
                                <div class="ak-dl__label">CUI</div>
                                <div class="ak-dl__value">@(!string.IsNullOrWhiteSpace(Model.CUI) ? Model.CUI : "—")</div>
                            </div>
                        </div>

                        <!-- NIT -->
                        <div class="col-12 col-lg-3">
                            <div class="ak-dl">
                                <div class="ak-dl__label">NIT</div>
                                <div class="ak-dl__value">@(!string.IsNullOrWhiteSpace(Model.NIT) ? Model.NIT : "—")</div>
                            </div>
                        </div>

                        <!-- Teléfono -->
                        <div class="col-12 col-lg-3">
                            <div class="ak-dl">
                                <div class="ak-dl__label">Teléfono</div>
                                <div class="ak-dl__value">@(!string.IsNullOrWhiteSpace(Model.TelefonoMovil) ? Model.TelefonoMovil : "—")</div>
                            </div>
                        </div>

                        <!-- Género -->
                        <div class="col-12 col-lg-3">
                            <div class="ak-dl">
                                <div class="ak-dl__label">Género</div>
                                <div class="ak-dl__value">@(!string.IsNullOrWhiteSpace(Model.Genero) ? Model.Genero : "—")</div>
                            </div>
                        </div>
                    </div>

                    <!-- Línea de Fechas -->
                    <div class="row g-4 mt-1 ak-dl-row">
                        <!-- Fecha de ingreso -->
                        <div class="col-12 col-lg-3">
                            <div class="ak-dl">
                                <div class="ak-dl__label">Fecha de ingreso</div>
                                <div class="ak-dl__value">
                                    @(Model.FechaIngreso == default(DateTime)
                                        ? "—"
                                        : string.Format("{0:dd/MM/yyyy}", Model.FechaIngreso))
                                </div>
                            </div>
                        </div>

                        <!-- Fecha de nacimiento -->
                        <div class="col-12 col-lg-3">
                            <div class="ak-dl">
                                <div class="ak-dl__label">Fecha de nacimiento</div>
                                <div class="ak-dl__value">
                                    @(Model.FechaNacimiento == null
                                        ? "—"
                                        : string.Format("{0:dd/MM/yyyy}", Model.FechaNacimiento))
                                </div>
                            </div>
                        </div>


                          <div class="col-12 col-lg-6">
                            <div class="ak-dl">
                                <div class="ak-dl__label">Correo</div>
                                <div class="ak-dl__value">@(!string.IsNullOrWhiteSpace(Model.Correo) ? Model.Correo : "—")</div>
                            </div>
                        </div>

                        <div class="col-12 col-lg-6">
                            <div class="ak-dl">
                                <div class="ak-dl__label">Dirección</div>
                                <div class="ak-dl__value">@(!string.IsNullOrWhiteSpace(Model.Direccion) ? Model.Direccion : "—")</div>
                            </div>
                        </div>

                    </div>


                </div>
            </div>



            @if (aud != null)
            {
                <!-- Switch para mostrar Auditoría -->
                <div class="d-flex justify-content-end mt-3">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" role="switch" id="toggleAuditoria">
                        <label class="form-check-label" for="toggleAuditoria">Mostrar auditoría</label>
                    </div>
                </div>

                <!-- Card de Auditoría (oculta por defecto) -->
                <div id="cardAuditoria" class="collapse">
                    <div class="card ak-card w-100 mt-3">
                        <div class="card-body">
                            <h6 class="mb-3">
                                <i class="fa-regular fa-clipboard me-2"></i>Auditoría
                            </h6>

                            <div class="row g-4 ak-dl-row">
                                <div class="col-12 col-lg-3">
                                    <div class="ak-dl">
                                        <div class="ak-dl__label">Creado por</div>
                                        <div class="ak-dl__value">@((string)aud.CreadoPor ?? "—")</div>
                                    </div>
                                </div>
                                <div class="col-12 col-lg-3">
                                    <div class="ak-dl">
                                        <div class="ak-dl__label">Fecha de creación</div>
                                        <div class="ak-dl__value">
                                            @(aud.FechaCreacion == null
                                                ? "—"
                                                : string.Format("{0:dd/MM/yyyy HH:mm}", aud.FechaCreacion))
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-lg-3">
                                    <div class="ak-dl">
                                        <div class="ak-dl__label">Modificado por</div>
                                        <div class="ak-dl__value">@((string)aud.ModificadoPor ?? "—")</div>
                                    </div>
                                </div>
                                <div class="col-12 col-lg-3">
                                    <div class="ak-dl">
                                        <div class="ak-dl__label">Fecha de modificación</div>
                                        <div class="ak-dl__value">
                                            @(aud.FechaModificacion == null
                                                ? "—"
                                                : string.Format("{0:dd/MM/yyyy HH:mm}", aud.FechaModificacion))
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="row g-4 mt-1 ak-dl-row">
                                <div class="col-12 col-lg-3">
                                    <div class="ak-dl">
                                        <div class="ak-dl__label">Eliminado por</div>
                                        <div class="ak-dl__value">@((string)aud.EliminadoPor ?? "—")</div>
                                    </div>
                                </div>
                                <div class="col-12 col-lg-3">
                                    <div class="ak-dl">
                                        <div class="ak-dl__label">Fecha de eliminación</div>
                                        <div class="ak-dl__value">
                                            @(aud.FechaEliminacion == null
                                                ? "—"
                                                : string.Format("{0:dd/MM/yyyy HH:mm}", aud.FechaEliminacion))
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            }

            <!-- Franja 3: Card de acciones (mismo look) -->
            <div class="card ak-card ak-actions-card w-100 mt-3">
                <div class="card-body d-flex justify-content-center gap-4 flex-wrap">
                    <a asp-action="Index" class="btn btn-ak btn-ak-success">
                        <i class="fa-solid fa-arrow-left ak-icon"></i> Regresar
                    </a>
                    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-ak btn-ak-primary">
                        <i class="fa-solid fa-pen-to-square ak-icon"></i> Editar
                    </a>
                </div>
            </div>

        </div>
    </div>
</div>

@section Scripts{
    <script>
        (function () {
            // Toggle de auditoría con Bootstrap Collapse
            const sw = document.getElementById('toggleAuditoria');
            const box = document.getElementById('cardAuditoria');
            if (!sw || !box) return;

            // Inicializa el collapse sin mostrarlo al cargar
            let col = null;
            try {
                col = new bootstrap.Collapse(box, { toggle: false });
            } catch (e) { /* si bootstrap no está, fallback abajo */ }

            sw.addEventListener('change', function () {
                if (col) {
                    if (sw.checked) col.show(); else col.hide();
                } else {
                    // Fallback sin Bootstrap JS (toggle de clase)
                    box.classList.toggle('show', sw.checked);
                }
            });
        })();
    </script>
}
