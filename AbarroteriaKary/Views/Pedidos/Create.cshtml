@model AbarroteriaKary.ModelsPartial.PedidoViewModel
@{
    ViewData["Title"] = "Nuevo Pedido";

}


<link rel="stylesheet" href="~/css/Pedidos.css" asp-append-version="true" />



<h2 class="mb-3">@ViewData["Title"]</h2>

@using (Html.BeginForm("Create", "Pedidos", FormMethod.Post, new { @id = "frmPedido", @autocomplete = "off" }))
{
    @Html.AntiForgeryToken()

    <!-- ====== ENCABEZADO ====== -->
    <div class="k-encabezado">
        <div class="row g-3">
            <div class="col-md-3">
                <label>Orden</label>
                <input asp-for="PedidoId" class="form-control" readonly />
            </div>

            <div class="col-md-3">
                <label>Proveedor</label>
                <select asp-for="ProveedorId" asp-items="Model.Proveedores" class="form-select">
                    <option value="">Seleccione proveedor</option>
                </select>
                <span asp-validation-for="ProveedorId" class="text-danger"></span>
            </div>

            <div class="col-md-3">
                <label>Fecha entrega</label>
                <input asp-for="FechaPosibleEntrega" type="date" class="form-control" />
                <span asp-validation-for="FechaPosibleEntrega" class="text-danger"></span>
            </div>

            <div class="col-md-3">
                <label>Estado</label>
                <select asp-for="EstadoPedidoId" asp-items="Model.Estados" class="form-select"></select>
                <span asp-validation-for="EstadoPedidoId" class="text-danger"></span>
            </div>

            <div class="col-12">
                <label>Observaciones</label>
                <textarea asp-for="Observacion" rows="2" class="form-control"></textarea>
                <span asp-validation-for="Observacion" class="text-danger"></span>

            </div>
        </div>
    </div>

    <!-- ====== BUSCADOR DE PRODUCTOS ====== -->
    <div class="k-bloque">
        <label class="mb-2">Producto</label>
        <div class="k-suggest">
            <input id="txtBuscarProducto" class="form-control" placeholder="Buscar por código o nombre..." />
            <div id="sugerencias" class="k-suggest-list d-none"></div>
        </div>
        <small class="text-muted">Escribe al menos 2 caracteres para buscar. Presiona en el resultado para agregar al detalle.</small>
    </div>

    <!-- ====== DETALLE ====== -->
    <div class="k-bloque">
        <div class="table-responsive">
            <table class="table k-table" id="tblDetalle">
                <thead>
                    <tr>
                        <th style="width:110px">Código</th>
                        <th style="min-width:160px">Nombre</th>
                        <th>Descripción</th>
                        <th style="width:100px">Referencia</th>
                        <th style="width:120px">Cantidad</th>
                        <th style="width:80px">Acción</th>
                    </tr>
                </thead>
                <tbody>
                    @* filas dinámicas via JS *@
                </tbody>
            </table>
        </div>
        <span class="text-danger" data-valmsg-for="Lineas" data-valmsg-replace="true"></span>
    </div>

    <!-- ====== BOTÓN ====== -->
    <div class="card ak-card ak-actions-card w-100 mt-3">
        <div class="card-body d-flex justify-content-center gap-5 flex-wrap">

        <a asp-action="Index" class="btn btn-ak btn-ak-cancel js-leave">
            <i class="fa-solid fa-xmark ak-icon"></i> Cancelar
        </a>


@*         <button type="submit" class="k-btn-primary">Generar Pedido</button> *@

            <button type="submit" class="btn btn-ak btn-ak-primary" id="btn-guardar">
                <i class="fa-solid fa-floppy-disk ak-icon"></i> Generar Pedido
            </button>
        </div>
    </div>

   
}





@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>
        // Identificador de página (lo lee tu JS global)
        window.PAGE = { module: 'Pedidos', view: 'Create' };

        // Config de esta vista (GENERADA por Razor, consumida por /js/pedidos.js)
        window.PEDIDOS = {
            creadoOk: @((TempData["PedidoCreadoOk"] as bool?) == true ? "true" : "false"),
            pedidoId: '@(TempData["PedidoCreadoId"] as string ?? "")',

            // URL relativa al action del PDF (tu route es /Pedidos/PedidosPdf/{id})
            pdfUrl: '@Url.Action("PedidosPdf", "Pedidos", new { id = TempData["PedidoCreadoId"] })',

            urls: {
                buscar: '@Url.Action("BuscarProductos", "Pedidos")',
                pdfBase: '@Url.Action("PedidosPdf", "Pedidos")',
                index: '@Url.Action("Index", "Pedidos")'
            }
        };
    </script>

    <script src="~/js/pedidos.js" asp-append-version="true" defer></script>
}















@* @section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script>

        // Identificador de página (para tu bootstrap global)
        window.PAGE = { module: 'Pedidos', view: 'Create' };

        // Datos dinámicos para esta vista (sin Razor dentro del .js)
        window.PEDIDOS = {
            creadoOk: @( (TempData["PedidoCreadoOk"] as bool?) == true ? "true" : "false"),
            pedidoId: '@(TempData["PedidoCreadoId"] as string ?? "")',
            urls: {
                buscar: '@Url.Action("BuscarProductos", "Pedidos")',
                pdfBase: '@Url.Action("PedidoPdf", "Pedidos")',   // se concatena /{id}
                index: '@Url.Action("Index", "Pedidos")'
            }
        };
    </script>

    <script src="~/js/pedidos.js" asp-append-version="true" defer></script>
}
 *@
