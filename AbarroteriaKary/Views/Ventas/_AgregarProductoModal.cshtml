@model AbarroteriaKary.ModelsPartial.VentaDetalleItemVM
@using System.Globalization

<div class="modal fade" id="modalAgregarProducto" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <!-- OJO: sin action, sin submit; es sólo contenedor -->
            <form id="form-agregar-linea" onsubmit="return false;">
                <div class="modal-header">
                    <h5 class="modal-title">Agregar producto a la venta</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>

                <div class="modal-body">
                    <div class="row g-3 align-items-start mb-1">
                        <div class="col-auto">
                            <div style="border:1px solid #e5e7eb;background:#fff;border-radius:10px;width:96px;height:96px;overflow:hidden;">
                                <img src="@(Model.ImagenUrl ?? "/img/no-image.png")"
                                     onerror="this.src='/img/no-image.png'"
                                     alt="ref" style="width:100%;height:100%;object-fit:contain;">
                            </div>
                        </div>
                        <div class="col">
                            <div class="row g-3">
                                <div class="col-12 col-md-8">
                                    <label class="form-label">Producto</label>
                                    <input class="form-control" value="@Model.NombreProducto" readonly>
                                </div>
                                <div class="col-12 col-md-4">
                                    <label class="form-label">Código</label>
                                    <input class="form-control" value="@Model.CodigoProducto" readonly>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row g-3">
                        <div class="col-12 col-md-4">
                            <label class="form-label">Stock disponible</label>
                            <input class="form-control" value="@Model.StockDisponible" readonly>
                        </div>
                        <div class="col-12 col-md-4">
                            <label class="form-label">Costo Unitario</label>
                            <input class="form-control" value="@Model.PrecioUnitario.ToString("C2", CultureInfo.GetCultureInfo("es-GT"))" readonly>
                        </div>
                        <div class="col-12 col-md-4">
                            <label class="form-label">Próximo a vencer</label>
                            <input class="form-control" value="@(Model.ProximoVencimiento?.ToString("dd/MM/yyyy") ?? "-")" readonly>
                        </div>
                    </div>

@*                     <div class="mt-3">
                        <label class="form-label">Cantidad a vender</label>
                        <input id="apCantidad" type="number" class="form-control" min="1" step="1" value="@Model.Cantidad" required>
                    </div>
 *@

                    <div class="mt-3">
                        <label class="form-label">Cantidad a vender</label>
                        <input id="apCantidad" type="number" class="form-control" min="1" step="1" value="@Model.Cantidad" required>
                        <div id="apCantidadFb" class="invalid-feedback"></div>
                    </div>



                    <!-- Hiddens para el JS -->
                    <input type="hidden" id="apProdId" value="@Model.ProductoId" />
                    <input type="hidden" id="apCodigo" value="@Model.CodigoProducto" />
                    <input type="hidden" id="apNombre" value="@Model.NombreProducto" />
                    <input type="hidden" id="apImagen" value="@Model.ImagenUrl" />
                    <input type="hidden" id="apPvp" value="@Model.PrecioUnitario.ToString(CultureInfo.InvariantCulture)" />
                    <input type="hidden" id="apStock" value="@Model.StockDisponible.ToString(CultureInfo.InvariantCulture)" />
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-ak btn-ak-cancel" data-bs-dismiss="modal">Regresar</button>
                    <!-- Botón tipo button: ¡no hace submit! -->
                    <button type="button" class="btn btn-ak btn-ak-primary" id="btnModalAdd">
                        <i class="fa-solid fa-cart-plus me-1"></i> Agregar a venta
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
