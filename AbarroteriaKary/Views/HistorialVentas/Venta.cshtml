@model AbarroteriaKary.ModelsPartial.HistorialVentaDetalleVM
@using System.Globalization
@{
    ViewData["Title"] = "Detalle de venta";
    var gt = CultureInfo.GetCultureInfo("es-GT");

    var sesionId = ViewBag.SesionId as string ?? "";
    var caja = ViewBag.CajaNombre as string ?? "-";
}
<div class="ak-toolbar mb-3 mt-4">
    <div class="ak-toolbar__row">
        <h1 class="ak-toolbar__title m-0">Detalle de venta @Model.VentaId</h1>
    </div>

    <div class="text-muted small mt-2">
        <div><b>Fecha:</b> @Model.Fecha.ToString("dd/MM/yyyy HH:mm")</div>
        <div>
            <b>Cliente:</b>
            @(string.IsNullOrWhiteSpace(Model.ClienteNombre) ? (Model.ClienteId ?? "-") : Model.ClienteNombre)
        </div>
        <div>
            <b>Vendedor:</b>
            @(string.IsNullOrWhiteSpace(Model.UsuarioNombre) ? (Model.UsuarioId ?? "-") : Model.UsuarioNombre)
        </div>
        @* opcional, si en el VM tienes SesionId *@
        @* <div><b>Sesión:</b> @Model.SesionId</div> *@
    </div>
</div>



<div class="table-responsive">
    <table class="table table-bordered table-striped table-hover align-middle table-kary-zebra">
        <thead class="text-center thead-kary">
            <tr>
                <th>Producto</th>
                <th>Cant.</th>
                <th>Precio</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody>
            @if (!Model.Lineas.Any())
            {
                <tr><td colspan="4" class="text-center py-4 text-muted">Sin líneas.</td></tr>
            }
            else
            {
                foreach (var l in Model.Lineas)
                {
                    <tr>
                        <td>@l.Nombre (@l.ProductoId)</td>
                        <td class="text-center">@l.Cantidad</td>
                        <td class="text-end">@l.PrecioUnitario.ToString("C2", gt)</td>
                        <td class="text-end">@l.Subtotal.ToString("C2", gt)</td>
                    </tr>
                }
            }
        </tbody>
        <tfoot>
            <tr>
                <th colspan="3" class="text-end">TOTAL:</th>
                <th class="text-end">@Model.Total.ToString("C2", gt)</th>
            </tr>
        </tfoot>
    </table>
</div>

<div class="mt-3 d-flex gap-2">
    <a asp-action="Index" class="btn btn-ak btn-ak-cancel"><i class="fa-solid fa-arrow-left me-1"></i> Volver al historial</a>
    <a asp-controller="Ventas" asp-action="Recibo" asp-route-id="@Model.VentaId"
       target="_blank" rel="noopener" class="btn btn-ak btn-ak-primary">
        <i class="fa-solid fa-file-pdf me-1"></i> Recibo PDF
    </a>
</div>
